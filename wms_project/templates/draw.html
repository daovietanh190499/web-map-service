<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draw on Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <style>
        /* Modal styles */
        #style-modal, #text-style-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 8px;
            width: 300px;
        }
        #style-modal label, #text-style-modal label {
            display: block;
            margin-bottom: 5px;
        }
        #style-modal input, #text-style-modal input,
        #style-modal select, #text-style-modal select,
        #style-modal button, #text-style-modal button {
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
        }
        #style-modal button, #text-style-modal button {
            cursor: pointer;
        }
        #style-modal-overlay, #text-style-modal-overlay {
            display: none;
            position: fixed;
            z-index: 999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
</head>
<body>
    <div id="map" style="height: 500px;"></div>

    <!-- Modal for vector style changes -->
    <div id="style-modal-overlay"></div>
    <div id="style-modal">
        <h3>Change Style</h3>
        <label for="modal-color">Fill Color:</label>
        <input type="color" id="modal-color" value="#3388ff">
        <label for="modal-border-color">Border Color:</label>
        <input type="color" id="modal-border-color" value="#000000">
        <label for="modal-border-weight">Border Weight:</label>
        <select id="modal-border-weight">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="8">8</option>
            <option value="12">12</option>
        </select>
        <input type="number" id="modal-border-weight" value="3" min="1" max="10">
        <label for="modal-border-style">Border Style:</label>
        <select id="modal-border-style">
            <option value="solid">Solid</option>
            <option value="dashed">Dashed</option>
            <option value="dotted">Dotted</option>
        </select>
        <button id="apply-style">Apply</button>
        <button id="cancel-style">Cancel</button>
    </div>

    <!-- Modal for text style changes -->
    <div id="text-style-modal-overlay"></div>
    <div id="text-style-modal">
        <h3>Change Text Style</h3>
        <label for="text-font">Font:</label>
        <select id="text-font">
            <option value="Arial">Arial</option>
            <option value="Verdana">Verdana</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Courier New">Courier New</option>
        </select>
        <label for="text-color">Color:</label>
        <input type="color" id="text-color" value="#000000">
        <label for="text-size">Size (px):</label>
        <input type="number" id="text-size" value="16" min="8" max="72">
        <button id="apply-text-style">Apply</button>
        <button id="cancel-text-style">Cancel</button>
    </div>

    <script>
        const map = L.map('map').setView([10.762622, 106.660172], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 20,
        }).addTo(map);

        const drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        const drawControl = new L.Control.Draw({
            edit: {
                featureGroup: drawnItems,
            },
            draw: {
                polygon: true,
                polyline: true,
                rectangle: true,
                circle: true,
                marker: true,
                circlemarker: false,
            },
        });

        // Add "Add Text" option to the draw menu
        const TextDrawHandler = L.Handler.extend({
            addHooks: function () {
                map.on('click', this._addText, this);
            },
            removeHooks: function () {
                map.off('click', this._addText, this);
            },
            _addText: function (e) {
                const text = prompt('Enter text:');
                if (text) {
                    const textLayer = L.marker(e.latlng, {
                        icon: L.divIcon({
                            className: 'custom-text-icon',
                            html: `<div style="font-size: 16px; color: black;">${text}</div>`,
                            iconSize: [0, 0],
                        }),
                    }).addTo(drawnItems);

                    textLayer.on('contextmenu', () => openTextStyleModal(textLayer));
                }
            },
        });

        drawControl.options.draw.text = {
            handler: TextDrawHandler,
            title: 'Add Text',
        };
        map.addControl(drawControl);

        let selectedLayer = null;

        // Modal references
        const styleModal = document.getElementById('style-modal');
        const styleModalOverlay = document.getElementById('style-modal-overlay');
        const modalColor = document.getElementById('modal-color');
        const modalBorderColor = document.getElementById('modal-border-color');
        const modalBorderWeight = document.getElementById('modal-border-weight');
        const modalBorderStyle = document.getElementById('modal-border-style');
        const applyStyleBtn = document.getElementById('apply-style');
        const cancelStyleBtn = document.getElementById('cancel-style');

        // Open modal
        function openStyleModal(layer) {
            selectedLayer = layer;

            // Pre-fill current styles
            if (layer.options) {
                modalColor.value = layer.options.fillColor || '#3388ff';
                modalBorderColor.value = layer.options.color || '#000000';
                modalBorderWeight.value = layer.options.weight || 3;
                modalBorderStyle.value = layer.options.dashArray ? 'dashed' : 'solid';
            }

            styleModal.style.display = 'block';
            styleModalOverlay.style.display = 'block';
        }

        // Close modal
        function closeStyleModal() {
            styleModal.style.display = 'none';
            styleModalOverlay.style.display = 'none';
            selectedLayer = null;
        }

        // Apply styles
        applyStyleBtn.addEventListener('click', () => {
            if (selectedLayer) {
                const newStyle = {
                    fillColor: modalColor.value,
                    color: modalBorderColor.value,
                    weight: parseInt(modalBorderWeight.value),
                    dashArray: modalBorderStyle.value === 'dashed' ? '5, 5' : null,
                };
                selectedLayer.setStyle && selectedLayer.setStyle(newStyle);
            }
            closeStyleModal();
        });

        cancelStyleBtn.addEventListener('click', closeStyleModal);

        // Handle right-click on layers
        drawnItems.on('contextmenu', (e) => {
            openStyleModal(e.layer);
        });

        // Modal references
        const textStyleModal = document.getElementById('text-style-modal');
        const textStyleModalOverlay = document.getElementById('text-style-modal-overlay');
        const textFont = document.getElementById('text-font');
        const textColor = document.getElementById('text-color');
        const textSize = document.getElementById('text-size');
        const applyTextStyleBtn = document.getElementById('apply-text-style');
        const cancelTextStyleBtn = document.getElementById('cancel-text-style');

        // Open text style modal
        function openTextStyleModal(layer) {
            selectedLayer = layer;

            const currentText = layer.getElement().querySelector('div');
            textFont.value = currentText.style.fontFamily || 'Arial';
            textColor.value = currentText.style.color || '#000000';
            textSize.value = parseInt(currentText.style.fontSize) || 16;

            textStyleModal.style.display = 'block';
            textStyleModalOverlay.style.display = 'block';
        }

        // Close text style modal
        function closeTextStyleModal() {
            textStyleModal.style.display = 'none';
            textStyleModalOverlay.style.display = 'none';
            selectedLayer = null;
        }

        // Apply text styles
        applyTextStyleBtn.addEventListener('click', () => {
            if (selectedLayer) {
                const currentText = selectedLayer.getElement().querySelector('div');
                currentText.style.fontFamily = textFont.value;
                currentText.style.color = textColor.value;
                currentText.style.fontSize = `${textSize.value}px`;
            }
            closeTextStyleModal();
        });

        cancelTextStyleBtn.addEventListener('click', closeTextStyleModal);

        // Add new layers
        map.on(L.Draw.Event.CREATED, function (e) {
            const layer = e.layer;
            drawnItems.addLayer(layer);
        });
    </script>
</body>
</html>